(window.webpackJsonpchat=window.webpackJsonpchat||[]).push([[0],{161:function(e,t,a){"use strict";a.r(t);var n=a(26);function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(a,!0).forEach(function(t){Object(n.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var s={items:[]};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case"ATTACHMENTS:SET_ITEMS":return c({},e,{items:n});case"ATTACHMENTS:REMOVE_FILE":return c({},e,{items:e.items.filter(function(e){return e.uid!==n.uid})});default:return e}}},162:function(e,t,a){"use strict";a.r(t);var n=a(26);function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(a,!0).forEach(function(t){Object(n.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var s={items:[],currentDialogId:window.location.pathname.split("dialog/")[1],isLoading:!1};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case"DIALOGS:SET_ITEMS":return c({},e,{items:n});case"DIALOGS:SET_IS_LOADING":return c({},e,{isLoading:n});case"DIALOGS:SET_CURRENT_DIALOG_ID":return c({},e,{currentDialogId:n});default:return e}}},163:function(e,t,a){"use strict";a.r(t);var n=a(125),r=a(26);function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(a,!0).forEach(function(t){Object(r.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var i={items:[],isLoading:!1};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments.length>1?arguments[1]:void 0,a=t.type,r=t.payload;switch(a){case"MESSAGES:SET_ITEMS":return s({},e,{items:r,isLoading:!1});case"MESSAGES:ADD_MESSAGE":return s({},e,{items:[].concat(Object(n.a)(e.items),[r])});case"MESSAGES:CHANGE_MESSAGE":return s({},e,{items:e.items.filter(function(e){return e._id!==r._id||(e.text=r.text)})});case"MESSAGES:REMOVE_MESSAGE":return s({},e,{items:e.items.filter(function(e){return e._id!==r})});case"MESSAGES:SET_IS_LOADING":return s({},e,{isLoading:r});default:return e}}},164:function(e,t,a){"use strict";a.r(t);var n=a(26);function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(a,!0).forEach(function(t){Object(n.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var s="undefined"===window.localStorage.token?void 0:window.localStorage.token,i={data:null,token:s,isAuthed:!!s};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case"USER:SET_DATA":return c({},e,{data:n,isAuthed:!0,token:window.localStorage.token});case"USER:SET_IS_AUTHED":return c({},e,{isAuthed:n});default:return e}}},230:function(e,t,a){e.exports=a.p+"static/media/wave.004b528d.svg"},231:function(e,t,a){e.exports=a.p+"static/media/waveBlack.8e9ed252.svg"},232:function(e,t,a){e.exports=a.p+"static/media/play.a1d839aa.svg"},233:function(e,t,a){e.exports=a.p+"static/media/pause.030b4c1a.svg"},235:function(e,t,a){e.exports=a.p+"static/media/checked.05bd65e9.svg"},236:function(e,t,a){e.exports=a.p+"static/media/unchecked.70aff14a.svg"},248:function(e,t,a){e.exports=a(502)},260:function(e,t,a){var n={"./":87,"./attachments":161,"./attachments.js":161,"./dialogs":162,"./dialogs.js":162,"./index":87,"./index.js":87,"./messages":163,"./messages.js":163,"./user":164,"./user.js":164};function r(e){var t=c(e);return a(t)}function c(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=c,e.exports=r,r.id=260},262:function(e,t,a){},303:function(e,t,a){},317:function(e,t,a){},320:function(e,t,a){},322:function(e,t,a){},323:function(e,t,a){},324:function(e,t,a){},329:function(e,t,a){},330:function(e,t,a){},368:function(e,t){},498:function(e,t,a){},499:function(e,t,a){},500:function(e,t,a){},502:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(4),s=a.n(c),i=a(40),o=a(23),l=a(42),u=a(122),m=a(57),d=a(227),f=a(87),p=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||m.d,g=[d.a],h=Object(m.e)(f.default,p(m.a.apply(void 0,g))),E=function(e){var t=e.isAuth,a=e.values,n=e.errors,r={email:function(e,t){t.email?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(t.email)||(e.email="Invalid email address"):e.email="Please Enter Email"},password:function(e,a){a.password?t||/^(?=.*[a-z])(?=.*[0-9])(?=.{8,})/i.test(a.password)||(e.password=t?"Invalid Password":"Your password is too easy"):e.password="Please Input Password"},repassword:function(e,t){t.repassword?(e.password||t.repassword!==t.password)&&(e.repassword="Passwords doesn't match"):e.repassword="Please repeat password"},fullname:function(e,a){t||a.fullname||(e.fullname="Please input your full name")}};Object.keys(a).forEach(function(e){r[e]&&r[e](n,a)})},v=a(507),b=a(509),y=a(8),O=a(52),w=a(3),S=a.n(w),_=(a(261),a(262),function(e){return r.a.createElement(O.a,Object.assign({},e,{className:S()(e.className,"button",{"button--large":"large"===e.size})}))}),j=(a(303),function(e){var t=e.children,a=e.className;return r.a.createElement("div",{className:S()("block",a)},t)}),I=a(12),k=function(e,t,a){if(e[a])return t[a]?"error":"success"},A=a(153),D=a.n(A),N=a(511),M=function(e){var t=e.text,a=e.type,n=void 0===a?"info":a,r=e.title,c=e.duration,s=void 0===c?3:c;return N.a[n]({message:r,description:t,duration:s})},P=a(230),x=a.n(P),T=a(231),C=a.n(T),L=a(232),R=a.n(L),U=a(233),G=a.n(U),F=function(e){var t=e.audio,a=e.isMe,c=Object(n.useState)(!1),s=Object(I.a)(c,2),i=s[0],o=s[1],l=Object(n.useState)(0),u=Object(I.a)(l,2),m=u[0],d=u[1],f=Object(n.useState)(0),p=Object(I.a)(f,2),g=p[0],h=p[1],E=Object(n.useRef)(null);return Object(n.useEffect)(function(){var e=E.current;e&&(e.addEventListener("playing",function(){o(!0)},!1),e.addEventListener("ended",function(){o(!1),h(0)},!1),e.addEventListener("pause",function(){o(!1)},!1),e.addEventListener("timeupdate",function(){var t=e.duration||0;d(e.currentTime),h(e.currentTime/t*100)},!1),e.addEventListener("loadeddata",function(){d(e.duration)}))},[]),r.a.createElement("div",{className:"message__audio"},r.a.createElement("audio",{ref:E,src:t,preload:"auto"}),r.a.createElement("div",{className:"message__audio-progress",style:{width:g+"%"}}),r.a.createElement("div",{className:"message__audio-info"},r.a.createElement("div",{className:"message__audio-btn"},r.a.createElement("button",{onClick:function(){i?E.current.pause():E.current.play()}},i?r.a.createElement("img",{src:G.a,alt:"Pause Icon"}):r.a.createElement("img",{src:R.a,alt:"Play Icon"}))),r.a.createElement("div",{className:"message__audio-wave"},r.a.createElement("img",{src:a?C.a:x.a,alt:"Wave Icon"})),r.a.createElement("span",{className:"message__audio-duration"},function(e){var t=Math.floor(e/60),a=(e%60).toFixed();return"".concat(t<10?"0":"").concat(t,":").concat(a<10?"0":"").concat(a)}(m))))},V=a(504),z=a(117),B=a.n(z),H=a(78),W=(a(317),function(e){var t=e.user,a=e.text,n=e.createdAt,c=e.isMe,s=e.unchecked,i=e.attachments,o=e.isAudio,l=e.isTyping,u=e.onRemoveMessage,m=e.setPreviewImage;return r.a.createElement("div",{className:S()("message",{"message--isme":c,"message--is-typing":l,"message--is-audio":o,"message--image":i&&1===i.length&&!a})},r.a.createElement("div",{className:"message__content"},r.a.createElement(Q,{isMe:c,unchecked:s}),c&&r.a.createElement(V.a,{content:r.a.createElement("div",{className:"message__actions"},r.a.createElement(O.a,{onClick:u,type:"danger"},"Delete")),trigger:"click"},r.a.createElement("div",{className:"message__icon-actions"},r.a.createElement(O.a,{type:"link",shape:"circle",icon:"ellipsis"}))),r.a.createElement("div",{className:"message__avatar"},r.a.createElement(ue,{user:t})),r.a.createElement("div",{className:"message__info"},(!i.length||i.length>1&&a||1===i.length&&a||o)&&r.a.createElement("div",{className:"message__bubble"},a&&!o&&r.a.createElement("p",{className:"message__text"},B()(a,/:(.+?):/g,function(e){return r.a.createElement(H.a,{emoji:e,set:"google",size:22,key:Math.random()})})),l&&r.a.createElement("div",{className:"message__typing"},r.a.createElement("span",{className:"dot one"}),r.a.createElement("span",{className:"dot two"}),r.a.createElement("span",{className:"dot three"})),o&&r.a.createElement(F,{audio:i[0].url,isMe:c})),i&&!!i.length&&!o&&r.a.createElement("div",{className:"message__attachments"},i.map(function(e){return r.a.createElement("div",{key:Math.random(),className:"message__attachments-item"},r.a.createElement(y.a,{type:"eye"}),r.a.createElement("img",{src:e.url,onClick:function(){return m(e.url)},alt:e.filename}))})),r.a.createElement("span",{className:"message__date"},r.a.createElement(te,{date:n})))))}),q=a(513),Z=a(506),J=(a(320),function(e){var t,a=e._id,n=e.user,c=e.currentDialogId,s=e.isMe,o=e.onSelect,l=e.lastMessage;return r.a.createElement(i.b,{to:"/dialogs/".concat(n.fullname.split(" ").join("_"))},r.a.createElement("div",{className:S()("dialogs__item",{"dialogs__item--online":n.isOnline,"dialogs__item--selected":c===a}),onClick:o.bind(void 0,a)},r.a.createElement("div",{className:"dialogs__item-avatar"},r.a.createElement(ue,{user:n})),r.a.createElement("div",{className:"dialogs__item-content"},r.a.createElement("div",{className:"dialogs__item-content-top"},r.a.createElement("b",null,n.fullname),r.a.createElement("span",{className:"dialogs__item-content-date"},(t=l.createdAt,t=new Date(t),Object(q.a)(t)?Object(Z.a)(t,"HH:mm"):Object(Z.a)(t,"MM.dd.yyyy")))),r.a.createElement("div",{className:"dialogs__item-content-bottom"},r.a.createElement("p",null,l.text?B()(l.text,/:(.+?):/g,function(e){return r.a.createElement(H.a,{emoji:e,set:"google",size:16})}):l.attachments.length&&"ogg"===l.attachments[0].ext?r.a.createElement("span",null,r.a.createElement(y.a,{type:"audio"})," Voice Message"):r.a.createElement("span",null,r.a.createElement(y.a,{type:"file-image"})," Image")),s&&r.a.createElement(Q,{isMe:s,unchecked:l.unchecked}),l.unchecked>0&&!s&&r.a.createElement("div",{className:"dialogs__item-content-bottom-unchecked-count"},l.unchecked>1?l.unchecked:1)))))}),X=a(235),Y=a.n(X),K=a(236),$=a.n(K),Q=function(e){var t=e.isMe,a=e.unchecked;return t?a?r.a.createElement("img",{src:$.a,alt:"UnCheckedIcon",className:"message__icon-unchecked"}):r.a.createElement("img",{src:Y.a,alt:"CheckedIcon",className:"message__icon-checked"}):""},ee=a(247),te=function(e){var t=e.date;return t?r.a.createElement(n.Fragment,null,Object(ee.a)(new Date(t),{addSuffix:!0})):""},ae=a(79),ne=a(237),re=(a(322),function(e){var t=e.items,a=e.myId,n=e.onSearch,c=e.inputValue,s=e.currentDialogId,i=e.onSelectDialog;return r.a.createElement("div",{className:"dialogs-wrapper"},r.a.createElement("div",{className:"chat__sidebar-search"},r.a.createElement(b.a.Search,{placeholder:"Search for dialogs",onChange:function(e){return n(e.target.value)},value:c})),r.a.createElement("div",{className:"dialogs"},t.length?Object(ne.orderBy)(t,["createdAt"],["desc"]).map(function(e){return r.a.createElement(J,Object.assign({user:e.author._id!==a?e.author:e.partner,isMe:e.lastMessage.user._id===a,onSelect:i,key:e._id},e,{lastMessage:e.lastMessage,currentDialogId:s}))}):r.a.createElement(ae.a,{image:ae.a.PRESENTED_IMAGE_SIMPLE})))}),ce=a(510),se=(a(323),function(e){var t=e.onRemoveMessage,a=e.baseRef,n=e.isLoading,c=e.items,s=e.myId,i=e.user,o=e.previewImage,l=e.setPreviewImage;return r.a.createElement("div",{ref:a,className:S()("messages",{"messages--loading":n})},n||!i?r.a.createElement(y.a,{type:"loading",spin:!0}):c&&c.length?r.a.createElement("div",{className:"messages-wrapper"},c.map(function(e){return r.a.createElement(W,Object.assign({isAudio:!!e.attachments.length&&"ogg"===e.attachments[0].ext,onRemoveMessage:t.bind(void 0,e._id),setPreviewImage:l,key:Math.random()},e,{isMe:e.user._id===s}))})):r.a.createElement(ae.a,{description:"Select dialog to start messaging or start new dialog by pressing button right to Dialogs List"}),r.a.createElement(ce.a,{visible:!!o,onCancel:function(){return l(null)},footer:null},r.a.createElement("img",{src:o,style:{width:"100%"},alt:"Preview"})))}),ie=a(26);a(324);function oe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function le(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?oe(a,!0).forEach(function(t){Object(ie.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):oe(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var ue=function(e){var t=e.user,a=e.style;if(t.avatar)return r.a.createElement("img",{style:a,src:t.avatar,alt:"".concat(t.fullname," avatar")});var n=function(e){var t=e.toString().substr(-3).split("").map(function(e){return e.charCodeAt(0)>255?255:e.charCodeAt(0)}),a=Object(I.a)(t,3),n=a[0],r=a[1],c=a[2],s=D()({r:n,g:r,b:c});return{color:s.lighten(10).saturate(10).toHexString(),colorLighten:s.lighten(30).saturate(30).toHexString()}}(t._id),c=t.fullname[0];return r.a.createElement("div",{className:"avatar avatar--empty",style:le({},a,{background:"linear-gradient(135deg, ".concat(n.color,", ").concat(n.colorLighten," 96%)")})},c)},me=a(240),de=(a(329),b.a.TextArea),fe=function(e){var t=e.toggleEmojiTab,a=e.emojiTabIsActive,n=e.setValue,c=e.value,s=e.handleEmojiSelect,i=e.handleSendMessage,o=e.handleFileUpload,l=e.attachments,u=e.removeAttachment,m=e.isRecording,d=e.onRecord,f=e.onStopRecording;return r.a.createElement("div",{className:"chat-input"},r.a.createElement("div",null,r.a.createElement("div",{className:"chat-input__actions"},r.a.createElement("div",{className:S()("chat-input__emoji-picker",{"chat-input__emoji-picker--visible":a})},r.a.createElement(H.b,{set:"google",onSelect:function(e){return s(e)}})),r.a.createElement(O.a,{onClick:t,type:"link",shape:"circle",className:"chat-input__smile-btn",icon:"smile"}),r.a.createElement(me.UploadField,{onFiles:o,containerProps:{className:"chat-input__actions-upload-photo"},uploadProps:{accept:".jpg,.png,.jpeg,.pdf,.webp,.gif",multiple:"multiple"}},r.a.createElement(O.a,{type:"link",shape:"circle",icon:"camera"}))),!m&&r.a.createElement(de,{style:{height:20},autosize:{maxRows:6},onChange:function(e){return n(e.target.value)},onKeyUp:i,placeholder:"Input your message",value:c}),m&&r.a.createElement("div",{className:"chat-input__record-status"},r.a.createElement("i",{className:"record-icon"}),r.a.createElement("span",null,"Recording"),r.a.createElement(y.a,{type:"close",onClick:f})),m||c||l&&l.length?r.a.createElement(O.a,{type:"link",shape:"circle",icon:"check-circle",onClick:i}):r.a.createElement("div",{className:"chat-input__record-btn"},r.a.createElement(O.a,{type:"link",shape:"circle",icon:"audio",onClick:d}))),r.a.createElement("div",{className:"chat-input-attachments"},r.a.createElement($e,{attachments:l,removeAttachment:u})))},pe=(a(330),function(e){var t=e.online,a=e.fullname,n=e.isMe;return r.a.createElement("div",{className:"chat__dialog-header-info"},r.a.createElement("b",{className:"chat__dialog-fullname"},a),!n&&r.a.createElement("span",{className:S()("status",{"status--online":t})},t?"online":"offline"))}),ge=a(512),he=a(93),Ee=a.n(he);Ee.a.defaults.baseURL=window.location.origin,Ee.a.defaults.headers.common.token=window.localStorage.token,window.axios=Ee.a;var ve=Ee.a,be=a(241),ye=a.n(be)()(window.location.origin.replace("3000","1337")),Oe={getAll:function(){return ve.get("/dialogs")},create:function(e){var t=e.partnerId,a=e.text;return ve.post("/dialogs",{partner:t,text:a})}},we={getDialogById:function(e){return ve.get("/messages/".concat(e))},send:function(e){var t=e.text,a=e.dialogId,n=e.attachments,r=void 0===n?[]:n;return ve.post("/messages",{text:t,dialog:a,attachments:r})},removeById:function(e){return ve.delete("/messages/".concat(e))}},Se={login:function(e){return ve.post("/user/login",e)},getMe:function(){return ve.get("/user/me")},verifyHash:function(e){return ve.get("/user/verify?hash=".concat(e))},register:function(e){return ve.post("/user/register",e)},findUsers:function(e){return ve.get("/user/find?query=".concat(e))}},_e={upload:function(e){var t=new FormData;return t.append("file",e),console.log(e),ve.post("/files",t,{headers:{"Content-Type":"multipart/form-data"}})}},je=function(e){var t=e.location,a=e.history,c=Object(n.useState)(!1),s=Object(I.a)(c,2),i=s[0],o=s[1],l=Object(n.useState)(""),u=Object(I.a)(l,2),m=u[0],d=u[1],f=Object(n.useState)("success"),p=Object(I.a)(f,2),g=p[0],h=p[1];return Object(n.useEffect)(function(){var e=t.search.split("hash=")[1];e&&Se.verifyHash(e).then(function(e){var t=e.data;h(t.status),"success"===t.status&&o(!0),d(t.message)}).catch(function(){o(!1),h("Error"),d("Confirmation error")})}),r.a.createElement(j,null,r.a.createElement(ge.a,{status:g,title:g.toUpperCase(),subTitle:"success"!==g||i?m:"Please check your email to verify your account",extra:"success"===g&&i&&r.a.createElement(O.a,{onClick:function(){a.push("/login")},type:"primary"},"Login")}))},Ie=a(508),ke={setDialogs:function(e){return{type:"DIALOGS:SET_ITEMS",payload:e}},setCurrentDialogId:function(e){return{type:"DIALOGS:SET_CURRENT_DIALOG_ID",payload:e}},fetchDialogs:function(){return function(e){Oe.getAll().then(function(t){var a=t.data;e(ke.setDialogs(a))})}}},Ae=ke,De={setMessages:function(e){return{type:"MESSAGES:SET_ITEMS",payload:e}},addMessage:function(e){return function(t,a){a().dialogs.currentDialogId===e.dialog._id&&t({type:"MESSAGES:ADD_MESSAGE",payload:e})}},setIsLoading:function(e){return{type:"MESSAGES:SET_IS_LOADING",payload:e}},removeMessageById:function(e){return function(t){console.log("Remove request for: ".concat(e)),we.removeById(e).then(function(){t({type:"MESSAGES:REMOVE_MESSAGE",payload:e})}).catch(function(){t(De.setIsLoading(!1))})}},fetchMessageSend:function(e){var t=e.text,a=e.dialogId,n=e.attachments;return function(e){we.send({text:t,dialogId:a,attachments:n})}},fetchMessages:function(e){return function(t){t(De.setIsLoading(!0)),we.getDialogById(e).then(function(e){var a=e.data;t(De.setMessages(a))}).catch(function(){t(De.setIsLoading(!1))})}}},Ne=De,Me={setUserData:function(e){return{type:"USER:SET_DATA",payload:e}},setIsAuthed:function(e){return{type:"USER:SET_IS_AUTHED",payload:e}},fetchUserData:function(){return function(e){Se.getMe().then(function(t){var a=t.data;e(Me.setUserData(a))}).catch(function(){e(Me.setIsAuthed(!1)),delete window.localStorage.token})}},fetchUserRegister:function(e){return function(t){return Se.register(e)}},fetchUserLogin:function(e){return function(t){return Se.login(e).then(function(e){var a=e.data,n=a.token;return t(Me.setUserData(a)),M({title:"success",type:"success"}),window.axios.defaults.headers.common.token=n,window.localStorage.token=n,t(Me.fetchUserData()),t(Me.setIsAuthed(!0)),a}).catch(function(){M({title:"Login Failed",text:"Error in email or password",type:"error"})})}}},Pe=Me,xe={setAttachments:function(e){return{type:"ATTACHMENTS:SET_ITEMS",payload:e}},removeAttachment:function(e){return{type:"ATTACHMENTS:REMOVE_FILE",payload:e}}},Te=Object(o.b)(function(e){return e.dialogs},Ae)(function(e){var t=e.fetchDialogs,a=e.currentDialogId,c=e.setCurrentDialogId,s=e.items,i=e.myId,o=Object(n.useState)(""),l=Object(I.a)(o,2),u=l[0],m=l[1],d=Object(n.useState)(Array.from(s)),f=Object(I.a)(d,2),p=f[0],g=f[1];return Object(n.useEffect)(function(){s.length?g(s):t()},[s,t]),ye.on("SERVER:DIALOG_CREATED",function(){t()}),ye.on("MESSAGES:NEW_MESSAGE",function(){t()}),r.a.createElement(re,{myId:i,items:p,onSearch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";g(s.filter(function(t){return(t.author._id===i?t.partner:t.author).fullname.toLowerCase().indexOf(e.toLowerCase())>=0})),m(e)},inputValue:u,onSelectDialog:c,currentDialogId:a})}),Ce=Object(o.b)(function(e){var t=e.dialogs,a=e.user,n=e.messages;return{currentDialogId:t.currentDialogId,items:n.items,isLoading:n.isLoading,user:a.data}},Ne)(function(e){var t=e.items,a=e.fetchMessages,c=e.currentDialogId,s=e.removeMessageById,i=(e.fetchMessageChange,e.addMessage),o=e.isLoading,l=e.myId,u=e.user,m=Object(n.useRef)(null),d=Object(n.useState)(null),f=Object(I.a)(d,2),p=f[0],g=f[1],h=function(e){i(e)};return Object(n.useEffect)(function(){return c&&a(c),ye.on("MESSAGES:NEW_MESSAGE",h),function(){ye.removeListener("MESSAGES:NEW_MESSAGE",h)}},[c]),Object(n.useEffect)(function(){m.current.scrollTop=m.current.scrollHeight},[t]),r.a.createElement(se,{user:u,onRemoveMessage:s,myId:l,baseRef:m,isLoading:o,items:t,setPreviewImage:g,previewImage:p})}),Le=a(59),Re=a.n(Le),Ue=a(125),Ge=a(121);function Fe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}var Ve=Object(o.b)(function(e){return{dialogs:e.dialogs,attachments:e.attachments.items}},function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Fe(a,!0).forEach(function(t){Object(ie.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Fe(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},Ne,{},xe))(function(e){var t=e.fetchMessageSend,a=e.setAttachments,c=e.removeAttachment,s=e.dialogs.currentDialogId,i=e.attachments;window.navigator.getUserMedia=window.navigator.getUserMedia||window.navigator.mozGetUserMedia||window.navigator.msGetUserMedia||window.navigator.webkitGetUserMedia;var o=Object(n.useState)(""),l=Object(I.a)(o,2),u=l[0],m=l[1],d=Object(n.useState)(!1),f=Object(I.a)(d,2),p=f[0],g=f[1],h=Object(n.useState)(!1),E=Object(I.a)(h,2),v=E[0],b=E[1],y=Object(n.useState)(null),O=Object(I.a)(y,2),w=O[0],S=O[1],_=function(e,t){e&&!e.contains(t.target)&&g(!1)},j=function(e){var a=new MediaRecorder(e);S(a),a.start(),a.onstart=function(){b(!0)},a.onstop=function(){b(!1)},a.ondataavailable=function(e){var a=new File([e.data],"audio.ogg",{type:"audio/ogg"});_e.upload(a).then(function(e){var a,n=e.data;a=n.file._id,t({text:u,dialogId:s,attachments:[a]})})}},k=function(e){console.log("Error: "+e)},A=function(){var e=Object(Ge.a)(Re.a.mark(function e(t){var n,r,c,s,o,l,u;return Re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=i,r=!0,c=!1,s=void 0,e.prev=4,o=Re.a.mark(function e(){var t,r;return Re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.value,r=Math.round(1e3*Math.random()),n=[].concat(Object(Ue.a)(n),[{uid:r,name:t.name,status:"uploading"}]),a(n),e.next=6,_e.upload(t).then(function(e){var t=e.data;n=n.map(function(e){return e.uid===r?{status:"done",uid:t.file._id,name:t.file.filename,url:t.file.url}:e})}).catch(function(){return{status:"error"}});case 6:case"end":return e.stop()}},e)}),l=t[Symbol.iterator]();case 7:if(r=(u=l.next()).done){e.next=12;break}return e.delegateYield(o(),"t0",9);case 9:r=!0,e.next=7;break;case 12:e.next=18;break;case 14:e.prev=14,e.t1=e.catch(4),c=!0,s=e.t1;case 18:e.prev=18,e.prev=19,r||null==l.return||l.return();case 21:if(e.prev=21,!c){e.next=24;break}throw s;case 24:return e.finish(21);case 25:return e.finish(18);case 26:a(n);case 27:case"end":return e.stop()}},e,null,[[4,14,18,26],[19,,21,25]])}));return function(t){return e.apply(this,arguments)}}();return Object(n.useEffect)(function(){var e=document.querySelector(".chat-input__smile-btn");return document.addEventListener("click",_.bind(void 0,e)),function(){document.addEventListener("click",_.bind(void 0,e))}}),s?r.a.createElement(fe,{toggleEmojiTab:function(){g(!p)},emojiTabIsActive:p,setValue:m,value:u,handleEmojiSelect:function(e){var t=e.colons;m((u+" "+t).trim())},handleSendMessage:function(e){13!==e.keyCode&&"click"!==e.type||(e.preventDefault(),w&&w.stop(),i&&i.length?(t({text:u,dialogId:s,attachments:i.map(function(e){return e.uid})}),a([])):u&&t({text:u,dialogId:s}),m(""),b(!1))},handleFileUpload:A,attachments:i,removeAttachment:c,isRecording:v,onRecord:function(){navigator.getUserMedia&&navigator.getUserMedia({audio:!0},j,k)},onStopRecording:function(){w.stop(),b(!1)}}):null}),ze=Object(o.b)(function(e){var t=e.dialogs,a=e.user;return{currentDialogId:t.currentDialogId,dialogs:t.items,user:a.data}})(function(e){var t=e.currentDialogId,a=e.user,n=e.dialogs,c=n.filter(function(e){return e._id===t})[0];if(!n.length||!t)return a&&r.a.createElement(pe,{fullname:a.fullname,isMe:!0});var s={};return s=c.author._id===a._id?c.partner:c.author,r.a.createElement(pe,{fullname:s.fullname,online:s.isOnline})}),Be=Object(o.b)(function(e){return{user:e.user.data}},Ae)(function(e){var t=e.user,a=e.getAll,c=Object(n.useState)(!1),s=Object(I.a)(c,2),i=s[0],o=s[1],l=Object(n.useState)(""),u=Object(I.a)(l,2),m=u[0],d=u[1],f=Object(n.useState)([]),p=Object(I.a)(f,2),g=p[0],h=p[1],E=Object(n.useState)(!1),v=Object(I.a)(E,2),b=v[0],y=v[1],O=Object(n.useState)(""),w=Object(I.a)(O,2),S=w[0],_=w[1],j=Object(n.useState)(""),k=Object(I.a)(j,2),A=k[0],D=k[1],N=function(){o(!1)};return r.a.createElement("div",null,r.a.createElement(Ze,{user:t,onShow:function(){o(!0)},onClose:N,isVisible:i,isSearching:b,inputValue:m,onModalOk:function(){Oe.create({partnerId:S,text:A}).then(function(){N(),y(!1),ye.on("DIALOGS:DIALOG_CREATED",a)}).catch(function(){y(!1)})},onChangeInput:function(e){d(e)},onSearch:function(e){y(!0),Se.findUsers(e).then(function(e){var t=e.data;y(!1),h(t)}).catch(function(){y(!0)})},onSelectUser:function(e){_(e)},onTextAreaChange:function(e){D(e.target.value)},users:g,messageText:A}))}),He=Ie.a.Option,We=b.a.TextArea,qe=function(e){var t=e.users,a=e.user,n=e.isVisible,c=e.onShow,s=e.onClose,i=e.onChangeInput,o=e.onSelectUser,l=e.inputValue,u=e.isSearching,m=e.onSearch,d=e.onModalOk,f=e.onTextAreaChange,p=e.messageText,g=t.map(function(e){return r.a.createElement(He,{key:e._id,style:{display:"flex",alignItems:"center"}},e.fullname,r.a.createElement("span",{style:{color:"lightgray",marginLeft:5}},e.email))});return r.a.createElement("div",{className:"chat__sidebar"},r.a.createElement("div",{className:"chat__sidebar-header"},r.a.createElement("div",null,r.a.createElement(y.a,{type:"team",style:{color:"rgba(0, 0, 0, .6)"}}),r.a.createElement("span",null,"Dialogs List")),r.a.createElement(O.a,{onClick:c,type:"link",shape:"circle",icon:"form",style:{color:"rgba(0, 0, 0, .6)"}}),r.a.createElement(ce.a,{visible:n,title:"Start new dialog",onClose:s,footer:[r.a.createElement(O.a,{key:"back",onClick:s},"Cancel"),r.a.createElement(O.a,{disabled:!p,key:"submit",type:"primary",loading:u,onClick:d},"Write!")]},r.a.createElement(v.a,null,r.a.createElement(v.a.Item,{label:"Input User's name or email"},r.a.createElement(Ie.a,{value:l,onChange:i,onSearch:m,onSelect:o,style:{width:"100%"},placeholder:"Find user by name or email",notFoundContent:"Nobody found :(",defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,showSearch:!0},g)),r.a.createElement(v.a.Item,{label:"Input your message"},r.a.createElement(We,{style:{marginTop:10},onChange:f,value:p,placeholder:"Input your message here",autosize:{minRows:1,maxRows:6}}))))),r.a.createElement("div",{className:"chat__sidebar-dialogs"},r.a.createElement(Te,{myId:a&&a._id})))};qe.defaultProps={users:[]};var Ze=qe,Je=a(505);function Xe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function Ye(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Xe(a,!0).forEach(function(t){Object(ie.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Xe(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function Ke(e){return new Promise(function(t,a){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){return t(n.result)},n.onerror=function(e){return a(e)}})}var $e=function(e){var t=e.attachments,a=e.removeAttachment,c=Object(n.useState)({previewVisible:!1,previewImage:"",fileList:t}),s=Object(I.a)(c,2),i=s[0],o=s[1];Object(n.useEffect)(function(){o(Ye({},i,{fileList:t}))},[t]);var l=function(){var e=Object(Ge.a)(Re.a.mark(function e(t){return Re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t),t.url||t.preview){e.next=5;break}return e.next=4,Ke(t.originalFileObj);case 4:t.preview=e.sent;case 5:o(Ye({},i,{previewImage:t.url||t.preview,previewVisible:!0}));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"clearfix"},r.a.createElement(Je.a,{action:"https://www.mocky.io/v2/5cc8019d300000980a055e76",listType:"picture-card",fileList:i.fileList,onPreview:l,onChange:function(e){var t=e.fileList;return o({fileList:t})},onRemove:function(e){return a(e)}}),r.a.createElement(ce.a,{visible:i.previewVisible,footer:null,onCancel:function(){return o(Ye({},i,{previewVisible:!1}))}},r.a.createElement("img",{alt:"example",style:{width:"100%"},src:i.previewImage})))},Qe=function(e){var t=e.values,a=e.touched,n=e.errors,c=e.handleChange,s=e.handleBlur,o=e.handleSubmit,l=e.isValid,u=e.isSubmitting;return r.a.createElement("div",null,r.a.createElement("div",{className:"auth__top"},r.a.createElement("h2",null,"Enter account"),r.a.createElement("p",null,"Please enter your account")),r.a.createElement(j,null,r.a.createElement(v.a,{className:"login-form"},r.a.createElement(v.a.Item,{validateStatus:k(a,n,"email"),help:a.email&&n.email||""},r.a.createElement(b.a,{id:"email",size:"large",prefix:r.a.createElement(y.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"E-mail",values:t.email,onChange:c,onBlur:s})),r.a.createElement(v.a.Item,{validateStatus:k(a,n,"password"),help:a.password&&n.password||""},r.a.createElement(b.a,{id:"password",size:"large",prefix:r.a.createElement(y.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Password",value:t.password,onChange:c,onBlur:s})),r.a.createElement(v.a.Item,null,u&&!l&&r.a.createElement("span",null,"Error!"),r.a.createElement(_,{disabled:u,onClick:o,size:"large",type:"primary",htmlType:"submit",className:"login-form-button button"},"Log in")),r.a.createElement(v.a.Item,null,r.a.createElement(i.b,{to:"register",className:"auth__register-link"},"Register")))))},et=Object(u.a)({mapPropsToValues:function(){return{email:"",password:""}},validate:function(e){var t={};return E({isAuth:!0,values:e,errors:t}),t},handleSubmit:function(e,t){var a=t.setSubmitting,n=t.props;h.dispatch(Pe.fetchUserLogin(e)).then(function(e){"success"===e.status&&n.history.push("/"),a(!1)}).catch(function(){return a(!1)})},displayName:"LoginForm"})(Qe),tt=function(e){var t=e.values,a=e.touched,n=e.errors,c=e.handleChange,s=e.handleBlur,o=e.handleSubmit,l=e.isSubmitting;return r.a.createElement("div",null,r.a.createElement("div",{className:"auth__top"},r.a.createElement("h2",null,"Register New Account"),r.a.createElement("p",null,"Please fill in these fields")),r.a.createElement(j,null,r.a.createElement(v.a,{className:"register-form"},r.a.createElement(v.a.Item,{validateStatus:k(a,n,"email"),hasFeedback:!0,help:a.email&&n.email||""},r.a.createElement(b.a,{id:"email",size:"large",prefix:r.a.createElement(y.a,{type:"mail",style:{color:"rgba(0, 0, 0, .25)"}}),placeholder:"Email",value:t.email,onChange:c,onBlur:s})),r.a.createElement(v.a.Item,null,r.a.createElement(b.a,{size:"large",id:"fullname",value:t.fullname,onChange:c,prefix:r.a.createElement(y.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Username"})),r.a.createElement(v.a.Item,{validateStatus:a.password?n.password?"error":"success":"",hasFeedback:!0,help:a.password&&n.password||""},r.a.createElement(b.a,{id:"password",size:"large",prefix:r.a.createElement(y.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Password",value:t.password,onChange:c,onBlur:s})),r.a.createElement(v.a.Item,{validateStatus:a.repassword?n.repassword?"error":"success":"",hasFeedback:!0,help:a.repassword&&n.repassword?n.repassword:""},r.a.createElement(b.a,{id:"repassword",size:"large",prefix:r.a.createElement(y.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Repeat Password",value:t.repassword,onChange:c,onBlur:s})),r.a.createElement(v.a.Item,null,r.a.createElement(_,{disabled:l,onClick:o,size:"large",type:"primary",htmlType:"submit",className:"button login-form-button"},"Create new account")),r.a.createElement(v.a.Item,null,r.a.createElement(i.b,{to:"login",className:"auth__register-link"},"Log in")))))},at=Object(u.a)({mapPropsToValues:function(){return{fullname:"",email:"",password:"",repassword:""}},validate:function(e){var t={};return E({isAuth:!1,values:e,errors:t}),t},handleSubmit:function(e,t){var a=t.setSubmitting,n=t.props;h.dispatch(Pe.fetchUserRegister(e)).then(function(e){"success"===e.data.status&&n.history.push("/register/verify"),a(!1)}).catch(function(){a(!1),M({text:"Such user exists",type:"error",title:"Error"})})},displayName:"RegisterForm"})(tt),nt=(a(498),function(){return r.a.createElement("section",{className:"auth"},r.a.createElement("div",{className:"auth__content"},r.a.createElement(l.b,{exact:!0,path:["/","/login"],component:et}),r.a.createElement(l.b,{exact:!0,path:"/register",component:at}),r.a.createElement(l.b,{exact:!0,path:"/register/verify",component:je})))}),rt=(a(499),Object(o.b)(function(e){return{user:e.user,attachments:e.attachments}})(Object(l.g)(function(e){var t=e.user,a=e.attachments,c=Object(n.useState)(""),s=Object(I.a)(c,2),i=s[0],o=s[1];return Object(n.useEffect)(function(){t.data&&o(t.data)},[t.data]),r.a.createElement("section",{className:"home"},r.a.createElement("div",{className:"chat"},r.a.createElement(Be,null),r.a.createElement("div",{className:"chat__dialog"},r.a.createElement("div",{className:"chat__dialog-header"},r.a.createElement(ze,null),i&&!i.token&&r.a.createElement("div",{className:"chat__account"},r.a.createElement(ue,{user:i}))),r.a.createElement("div",{className:"chat__dialog-messages",style:{height:"calc(100% - ".concat(a.items.length>=1?263:138,"px)")}},r.a.createElement(Ce,{myId:i._id||""})),r.a.createElement(Ve,null))))}))),ct=Object(o.b)(function(e){return{isAuthed:e.user.isAuthed}})(function(e){var t=e.isAuthed;return r.a.createElement("div",{className:"wrapper"},r.a.createElement(l.d,null,r.a.createElement(l.b,{exact:!0,path:["/login","/register","/register/verify"],component:nt}),r.a.createElement(l.b,{path:"/",render:function(){return t?r.a.createElement(rt,null):r.a.createElement(l.a,{to:"/login"})}})))});a(500),a(501);h.dispatch(Pe.fetchUserData()),s.a.render(r.a.createElement(o.a,{store:h},r.a.createElement(i.a,null,r.a.createElement(ct,null))),document.querySelector("#root"))},87:function(e,t,a){"use strict";a.r(t);var n=a(57);t.default=Object(n.c)(["messages","dialogs","user","attachments"].reduce(function(e,t){return e[t]=a(260)("./".concat(t)).default,e},{}))}},[[248,1,2]]]);
//# sourceMappingURL=main.45040fe7.chunk.js.map